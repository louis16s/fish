# 智能超声波液位计（RS485 / Modbus）项目整合说明

> 本文档整合《使用手册》《RS485通讯协议》《调试步骤说明》等资料，形成统一的工程接入与调试说明文档，便于现场安装、开发接入与系统集成。

---

# 1. 产品概述

智能超声波液位计是一款基于超声波测距原理的非接触式液位测量仪表，支持：

- 📏 测量范围：5m / 10m / 15m / 20m / 25m
- 🎯 分辨率：1mm
- 📡 数字输出：RS485（Modbus RTU）
- 📈 模拟输出：4–20mA
- 🔁 继电器输出：上限 / 下限双继电器
- 💧 防护等级：IP65 / IP68
- ⚡ 供电：DC12V / DC24V / AC220V

（技术参数整理自图册第4页技术参数说明 fileciteturn0file3）

---

# 2. RS485 通讯说明

## 2.1 通讯模式

- 协议：Modbus RTU
- 通讯方式：RS485 半双工主从模式
- 主机两帧之间建议间隔 ≥ 1s

（来源：通讯协议说明 fileciteturn0file1）

---

## 2.2 串口参数

| 参数 | 数值 |
|------|------|
| 波特率 | 9600bps |
| 数据位 | 8 |
| 停止位 | 1 |
| 校验 | 无（N） |
| CRC | CRC-16（多项式 0xA001） |

（来源：通讯协议说明 fileciteturn0file1）

---

## 2.3 功能码

- 使用功能码：`0x03`（读保持寄存器）

### 主机请求帧格式

```
[地址][03][起始寄存器Hi][起始寄存器Lo]
[数量Hi][数量Lo][CRCLo][CRCHi]
```

### 从机响应帧格式

```
[地址][03][字节数N][数据...][CRCLo][CRCHi]
```

异常返回：

```
[地址][0x80 + 功能码][异常码][CRCL][CRCH]
```

（来源：通讯协议说明 fileciteturn0file1）

---

# 3. 寄存器说明

| 地址 | 名称 | 长度 | 说明 |
|------|------|------|------|
| 0000H | 液位值 | 2字节 | 单位：mm 等比例值 |
| 0001H | 空距值 | 2字节 | 探头到液面距离 |
| 0002H | 安装高度 | 2字节 | 探头安装高度 |
| 0003H | 温度值 | 2字节 | 放大10倍 |
| 0004H | 继电器状态 | 2字节 | 低4位有效 |
| 0005H | 盲区 | 2字节 | 可调 |

数据说明：

- 2098 → 2.098m
- 200 → 20.0℃

继电器位说明：

| 位 | 功能 |
|----|------|
| BIT3 | AHH |
| BIT2 | AH |
| BIT1 | AL |
| BIT0 | ALL |

（来源：通讯协议说明 fileciteturn0file1）

---

# 4. 通讯示例

读取地址 0x01 的液位值（寄存器 0000H）

### 请求

```
01 03 00 00 00 01 84 0A
```

### 响应示例

```
01 03 02 05 78 BB 36
```

解析：

```
0x0578 = 1400 → 1.400m
```

（来源：协议示例说明 fileciteturn0file1）

---

# 5. 接线说明

## 5.1 RS485 接线

- A 接 A
- B 接 B
- 建议共地

（来源：485调试步骤 fileciteturn0file2）

---

## 5.2 端子定义（四线制）

| 端子 | 说明 |
|------|------|
| P+ / P- | 电源 |
| L1 / L2 | 下限继电器 |
| H1 / H2 | 上限继电器 |
| I+ / I- | 4-20mA |
| A / B | RS485 |

（来源：图册第5页接线图 fileciteturn0file3）

---

# 6. 仪表菜单与调试

## 6.1 进入菜单

- 按 SET
- 输入密码 2000
- OK 进入

（来源：图册第5页按键说明 fileciteturn0file3）

---

## 6.2 关键菜单

### P02
20mA 对应液位设置

### P03
显示模式：

- 00：液位 + 温度
- 01：空距 + 温度
- 02：液位 + 空距

### P04
探头安装高度（必须真实值）

> 设置完成后自动校准 H 和 L

### P05
响应速度：

| 值 | 说明 |
|----|------|
| 00 | 最快 |
| 01 | 较快 |
| 02 | 中速 |
| 03 | 慢速 |

（来源：图册第5页参数说明 fileciteturn0file3）

---

# 7. 继电器控制逻辑

## 上限继电器 H

- 液位 > H → 闭合
- 液位 < H - dH → 断开

## 下限继电器 L

- 液位 < L → 闭合
- 液位 > L + dL → 断开

可实现泵启停回差控制。

（来源：图册第5页继电器说明 fileciteturn0file3）

---

# 8. 多机通讯建议

- 默认地址：01
- 菜单 P07 设置通讯地址
- 多机建议：01 / 02 / 03...

（来源：调试步骤说明 fileciteturn0file2）

---

# 9. 工程开发建议

- 轮询周期 ≥ 1s
- 增加通讯超时保护
- 增加液位回差避免抖动
- 多传感器统一串口参数
- 上位机做好异常码解析

---

# 10. 版本信息

本 README 整合以下文档：

- 使用手册（图册） fileciteturn0file3
- RS485 通讯协议说明 fileciteturn0file1
- 485 调试步骤说明 fileciteturn0file2

---

如需扩展：

- ESP32 示例代码
- Modbus CRC 计算函数
- 多设备轮询程序框架

可在此 README 基础上继续补充。

